#include "z.h"

#include <zlib.h>

#define windowBits 15
#define ENABLE_ZLIB_GZIP 32

int uncompress_buffer(unsigned char *inbuf, size_t ilen, unsigned char *outbuf, size_t olen)
{
    int rc = -1;
    z_stream strm = {0};

    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;
    strm.opaque = Z_NULL;

    strm.next_in = inbuf;
    strm.avail_in = ilen;

    strm.next_out = outbuf;
    strm.avail_out = olen;

    rc = inflateInit2(&strm, windowBits | ENABLE_ZLIB_GZIP);
    if (rc < 0) {
        goto out;
    }
    rc = inflate(&strm, Z_NO_FLUSH);
    if (rc != Z_STREAM_END) {
        rc = -1;
        goto out;
    }
    rc = olen - strm.avail_out;
    inflateEnd(&strm);

 out:
    return rc;
}

/*
 * Editor modelines  -  https://www.wireshark.org/tools/modelines.html
 *
 * Local variables:
 * c-basic-offset: 4
 * tab-width: 8
 * indent-tabs-mode: nil
 * End:
 *
 * vi: set shiftwidth=4 tabstop=8 expandtab:
 * :indentSize=4:tabSize=8:noTabs=true:
 */
